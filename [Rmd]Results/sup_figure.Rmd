---
title: "Supplemental Figures"
output: html_document
---

## Article information

Temporal dynamics of auditory bistable perception correlated with a fluctuation of baseline pupil size

Yuta Suzuki, Hsin-I Liao, Shigeto Furukawa

NTT Communication Science Laboratories, NTT Corporation, Atsugi 243-0198, Japan

*Corresponding author: Yuta Suzuki
NTT Communication Science Laboratories, NTT Corporation, Atsugi 243-0198, Japan
Tel: +81-046-240-3525, 
E-mail: yuuta.suzuki.fc@hco.ntt.co.jp


```{r child="readFunc.Rmd"}
```
## figure 5
```{r, message=FALSE, echo=FALSE, warning=FALSE,fig.width = 10, fig.height = 10}
# countFigNum = 1
# # save(data_ccorr,betaWtFunc,
# #      pVal,ind_data_ROC, file = "./data/Exp1/Figure3.RData")
# load("./data/Exp1/Figure3.RData")
# # data = fromJSON(file="./data/Exp1/data_cross_corr_trial2.json")
# # 
# # #### data loading --------------------------------------------------------------------
# # dat <- list(matrix(unlist(data$raw),nrow=length(data$raw),byrow=T),
# #             matrix(unlist(data$raw_queue),nrow=length(data$raw_queue),byrow=T))
# # 
# # names(dat) <- c('trial','seconds')
# ggName =  c('shuffled','raw')
# # numOfTrial = dim(dat$trial)[1]
# # numOfSub = length(unique(data$sub))
# # lengthOfTime = dim(dat$trial)[2]
# # 
# # ind_data <- data.frame(
# #   sub =  rep( data$sub, times = rep( lengthOfTime, numOfTrial)),
# #   data_y = c(t(matrix(t(dat$trial),nrow=1))),
# #   condition = rep(ggName[data$randFlag+1], times = rep( lengthOfTime, numOfTrial)),
# #   data_x = data$lags_trial
# # )
# # 
# # numOfTrial = dim(dat$seconds)[1]
# # numOfSub = length(unique(data$sub))
# # lengthOfTime = dim(dat$seconds)[2]
# # 
# # ind_data2 <- data.frame(
# #   sub =  rep( data$sub, times = rep( lengthOfTime, numOfTrial)),
# #   data_y = c(t(matrix(t(dat$seconds),nrow=1))),
# #   condition = rep(ggName[data$randFlag+1], times = rep( lengthOfTime, numOfTrial)),
# #   data_x = data$lags_second
# # )
# 
# #### TRIALS ------------------------------------------------------------------
# 
# # data_ccorr = aggregate( data_y ~ sub*condition*data_x, data = ind_data, FUN = "mean")
# # data_ccorr = data_ccorr[order(data_ccorr$sub,data_ccorr$condition),]
# 
# config = list(lim_x = c(min(data_ccorr$data_x),max(data_ccorr$data_x)),
#               lim_y = c(-0.2, 0.2),
#               sigBarLoc = -0.1,
#               alpha = 0.4,
#               stride = 0.1,
#               label_x = "Lag of # of trials",
#               label_y = "Correlation coefficient",
#               title = ""
#               # grCol = c( "gray","#FFFFFF"),
#               # gr_outline =c("black","black")
# )
# 
# pVal = NULL
# for (iTrial in unique(data_ccorr$data_x)){
#   tmp = data_ccorr[data_ccorr$data_x == iTrial,]
#   d = t.test(tmp[tmp$condition == ggName[1],]$data_y,
#              tmp[tmp$condition == ggName[2],]$data_y)
#   pVal = rbind(pVal,round(d[["p.value"]], digits = 4))
# }
# q.values <- p.adjust(pVal, method = "BH")
# 
# dat_p = data.frame(
#   pVal = q.values,
#   data_y = 1,
#   data_x = unique(data_ccorr$data_x),
#   condition='sig'
# )
# 
# dat_p['flag'] = rep('gray',dim(dat_p)[1])
# ind = dat_p['pVal'] < 0.1 & dat_p['pVal'] > 0.05
# dat_p['data_y'][ind] = config$sigBarLoc
# dat_p['flag'][ind] = 'gray'
# ind = dat_p['pVal'] < 0.05
# dat_p['data_y'][ind] = config$sigBarLoc
# dat_p['flag'][ind] = 'black'
# 
# #### Figure3A(time-course) ---------------------------------------------------------------------
# p <- disp(data_ccorr,config,1,c("condition","condition"))+
#   geom_point(data=dat_p, aes(x=data_x, y = data_y),color=dat_p$flag, size = 2,shape=15)+
#   geom_vline(xintercept=0,colour="black",size=0.5)
# 
# p <- p + theme(
#   # legend.position = 'none'
#   legend.position = c(0.8, 0.9),
#   legend.text=element_text(size=14)
# )
# 
# config$ylim = round(seq(-0.2,0.2,0.1),2)
# config$ylim_stride = 0.02
# config$xlim = round(seq(-80,80,20),2)
# config$xlim_stride = 5
# p = setEmptyStyle(p,config)
# p = p +
#   #   scale_y_continuous(breaks=round(seq(-0.2,0.2,0.1),2))+
#   scale_x_continuous(breaks=round(seq(-80,80,20),2))
# #   coord_cartesian(xlim=c(-85,85),ylim=c(-0.22,0.22),expand=FALSE)+
# #   annotate(x=-80, xend=80, y=-0.22, yend=-0.22, colour="black", lwd=0.5, geom="segment")+
# #   annotate(x=-85, xend=-85, y=-0.2, yend=0.2, colour="black", lwd=0.5, geom="segment")+
# #   theme(
# #     axis.ticks = element_line(colour = "black",size = 0.5)
# #   )
# 
# eval(parse(text=paste("p", countFigNum ,"=p", sep="")))
# countFigNum = countFigNum+1
# 
# #### Figure3B(peak correlation) ####
# 
# config$label_x = ''
# config$label_y = 'Peak correlation coefficient'
# config$lim_y = c(0,0.5)
# 
# maxVal = aggregate( data_y ~ sub*condition, data = data_ccorr, FUN = "max")
# # anovakun(maxVal,"sA",long=T, peta=T)
# # sigPair = makeSigPair(forDrawingPost)
# 
# p = dispLineGraph(maxVal,config,c("condition"))+
#   # ggtitle('(c) Correlation coefficient')+
#   coord_cartesian(ylim=config$lim_y)+
#   theme(axis.text.x = element_text(angle = 30, hjust = 1))
# 
# # p <- drawSignificance(p,sigPair,0.4,0.02,TRUE)
# config$ylim = round(seq(0,0.4,0.1),2)
# config$ylim_stride = 0.05
# config$xlim = round(seq(1,2,1),2)
# config$xlim_stride = 0.5
# 
# p = setEmptyStyle(p,config)
# # p = p +
# #   scale_y_continuous(breaks=round(seq(0,0.5,0.1),2))+
# #   coord_cartesian(xlim=c(0.5,2.5),ylim=c(-0.05,0.55),expand=FALSE)+
# #   annotate(x=1, xend=2, y=-0.05, yend=-0.05, colour="black", lwd=0.5, geom="segment")+
# #   annotate(x=0.5, xend=0.5, y=0, yend=0.5, colour="black", lwd=0.5, geom="segment")+
# #   theme(
# #     axis.ticks = element_line(colour = "black",size = 0.5)
# #   )
# 
# eval(parse(text=paste("p", countFigNum ,"=p", sep="")))
# countFigNum = countFigNum+1
# 
# #### Figure3C(lag at peak) #####
# t = aggregate( data_y ~ sub*condition, data = data_ccorr, FUN = "max")
# 
# maxLag = NULL
# for(i in 1 : length(t$data_y)){
#   tmp = data.frame(
#     sub = t$sub[i],
#     condition = t$condition[i],
#     data_y = data_ccorr[data_ccorr$data_y == t$data_y[i],]$data_x
#   )
#   maxLag = rbind(maxLag,tmp)
# }
# config$label_x = ''
# config$label_y = 'Lag to pupil size [trial]'
# 
# print(t.test(maxLag[maxLag$condition == 'raw',]$data_y, mu=0, alternative="less"))
# 
# # anovakun(maxLag,"sA",long=T, peta=T)
# # sigPair = makeSigPair(forDrawingPost)
# maxLag = maxLag[maxLag$condition == 'raw',]
# p = dispBarGraph(maxLag,config,c("condition"))+
#   theme(axis.text.x = element_text(angle = 30, hjust = 1))
# 
# config$ylim = round(seq(-10,0,5),2)
# config$ylim_stride = 2
# config$xlim = round(seq(1,1,1),2)
# config$xlim_stride = 0.5
# 
# p = setEmptyStyle(p,config)
# # p = p +
# #   scale_y_continuous(breaks=round(seq(-15,0,5),2))+
# #   coord_cartesian(xlim=c(0.5,1.5),ylim=c(-17,3),expand=FALSE)+
# #   annotate(x=1, xend=1, y=-17, yend=-17, colour="black", lwd=0.5, geom="segment")+
# #   annotate(x=0.5, xend=0.5, y=-15, yend=0, colour="black", lwd=0.5, geom="segment")+
# #   theme(
# #     axis.ticks = element_line(colour = "black",size = 0.5)
# #   )
# 
# eval(parse(text=paste("p", countFigNum ,"=p", sep="")))
# countFigNum = countFigNum+1
# 
# #### Figure3D(LMM) ######## 
# 
# data=fromJSON(file="./data/Exp1/data_include_past2.json")
# pVal = NULL
# 
# betaWtFunc = data.frame()
# tmpAIC_model2 = NULL
# tmpAIC_model1 = NULL
# for(i in -20:20){
#   ind_data <- data.frame(
#     sub =  unlist(data$sub),
#     PDR = unlist(data[[paste("PDR_lag",i,sep="")]]),
#     ave = unlist(data[["ave"]]),
#     Baseline = unlist(data[["Baseline"]]),
#     diff = unlist(data[["diff"]]),
#     numOfSwitch = unlist(data[["numOfSwitch"]])
#   )
#   
#   ind_data[ind_data$numOfSwitch > 2,]$numOfSwitch = 2
#   ind_data = ind_data[ind_data$PDR != 0,]
#   
#   model = lmer( numOfSwitch ~ PDR + (1+PDR|sub),ind_data)
#   gt = ranef(model)[["sub"]][["PDR"]]
#   
#   model = summary(model)
#   
#   pVal = rbind(pVal,model[["coefficients"]]['PDR',]['Pr(>|t|)'])
#   
#   subpVal=NULL
#   for(iSub in unique(unlist(data$sub))){
#     tmp  = ind_data[ind_data$sub == iSub,]
#     submodel = lm(numOfSwitch ~ PDR, data = tmp)
#     subpVal = rbind(subpVal,summary(submodel)[["coefficients"]]['PDR',]['Pr(>|t|)'])
#   }
#   
#   betaWt = data.frame(
#     sub = unique(unlist(data$sub)),
#     data_y = gt + model[["coefficients"]]['PDR',]['Estimate'],
#     lag = i,
#     pval = p.adjust(as.numeric(subpVal), method = "BH")
#   )
#   betaWtFunc =  rbind(betaWtFunc,betaWt)
#   
# }
# 
# betaWtFunc$sub = subName[betaWtFunc$sub]
# dat_ave = aggregate( data_y ~ lag, data = betaWtFunc, FUN = "mean")
# dat_ave$sub = 'average'
# dat_ave$pval = p.adjust(pVal, method = "BH")
# 
# betaWtFunc = rbind(betaWtFunc,dat_ave)
# 
# sigBarLoc = 0
# betaWtFunc['flag'] = rep('white',dim(betaWtFunc)[1])
# ind = betaWtFunc['pval'] < 0.1 & betaWtFunc['pval'] > 0.05
# # betaWtFunc['data_y'][ind] = sigBarLoc
# betaWtFunc['flag'][ind] = 'gray'
# ind = betaWtFunc['pval'] < 0.05
# # betaWtFunc['data_y'][ind] = sigBarLoc
# betaWtFunc['flag'][ind] = 'black'
# 
# betaWtFunc$data_x = betaWtFunc$lag
# 
# config = list(lim_x = c(min(betaWtFunc$data_x),max(betaWtFunc$data_x)),
#               lim_y = c(-0.05,0.14),
#               # lim_y = c(-7.5, 1),
#               alpha = 0.4,
#               stride = 0.1,
#               label_x = "Trial since current answer",
#               label_y = "Beta weight",
#               title = "",
#               errorWid = 0.3
#               # grCol = c( "gray","#FFFFFF"),
#               # gr_outline =c("black","black")
# )
# betaWtFunc$numOfSwitch = 0
# 
# betaWtFunc_sig = betaWtFunc[betaWtFunc$sub == 'average',]
# betaWtFunc_sig$data_y = -0.1
# p <- dispBarGraph(betaWtFunc,config,c("data_x"))+
#   geom_point(data=betaWtFunc_sig, aes(x=lag, y = data_y),color= betaWtFunc_sig$flag, size = 2,shape=15)
# 
# config$ylim = round(seq(0,0.15,0.05),4)
# config$ylim_stride = 0.02
# config$xlim = round(seq(-20,20,5),2)
# config$xlim_stride = 1
# 
# p = setEmptyStyle(p,config)
# 
# eval(parse(text=paste("p", countFigNum ,"=p", sep="")))
# countFigNum = countFigNum+1
# 
# #### Figure3E(ROC) ######## 
# data=fromJSON(file="./data/Exp1/roc_past2.json")
# 
# ggName = c('Baseline','Transient')
# ggName2 = c('e1','e2')
# dat <- list((matrix(unlist(data$FalsePos),nrow=length(data$FalsePos),byrow=T)),
#             (matrix(unlist(data$TruePos),nrow=length(data$TruePos),byrow=T)))
# 
# names(dat) <- c('FalsePos','TruePos')
# 
# numOfSub = length(unique(data$sub))
# numOfTrial = dim(dat$FalsePos)[1]
# lengthOfTime = dim(dat$FalsePos)[2]
# timeLen = c(0,1)
# 
# ind_data_ROC = data.frame(
#   sub =  rep( data$sub, times = rep( lengthOfTime, numOfTrial)),
#   data_y = t(matrix(t(dat$TruePos),nrow=1)),
#   data_x = t(matrix(t(dat$FalsePos),nrow=1)),
#   lag = rep( as.character(data$lag), times = rep( lengthOfTime, numOfTrial)),
#   condition = rep( ggName[unlist(data$type)+1], times = rep( lengthOfTime, numOfTrial)),
#   exp = rep( ggName2[unlist(data$exp)], times = rep( lengthOfTime, numOfTrial))
# )
# ind_data_ROC$lag <- factor(ind_data_ROC$lag,levels =c("-20","-15","-10","-5","0","5","10","15","20"))
# ind_data_ROC = ind_data_ROC[ind_data_ROC$exp == 'e1' & ind_data_ROC$condition == 'Baseline' ,]
# ind_data_ROC = aggregate( . ~ lag, data = ind_data_ROC, FUN = "mean")
# 
# p = ggplot(ind_data_ROC,aes(x=data_y,y = data_x,group = interaction(sub,lag),color=lag))+
#   geom_line()+
#   annotate(x=0, xend=1, y=0, yend=1, colour="black", lwd=0.5, geom="segment")+
#   facet_wrap(sub ~ .)
# 
# 
# ind_data = data.frame(
#   sub = unlist(data$sub),
#   data_y =unlist( data$AUC),
#   lag = unlist(data$lag),
#   condition = ggName[unlist(data$type)+1],
#   exp = ggName2[unlist(data$exp)]
# )
# 
# dat_p = data.frame()
# for(iExp in 1:2){
#   
#   for (iCondition in 1:2){
#     pVal = NULL
#     for(iLag in unique(ind_data$lag)){
#       tmp = ind_data[ind_data$lag == iLag & 
#                        ind_data$exp == ggName2[iExp] &
#                        ind_data$condition == ggName[iCondition],]
#       d = t.test(tmp$data_y,mu=0.5, alternative="greater")
#       pVal = rbind(pVal,round(d[["p.value"]], digits = 4))
#     }
#     tmp_dat_p = data.frame(
#       pVal = p.adjust(pVal, method = "BH"),
#       data_y = 0,
#       data_x = unique(ind_data$lag),
#       condition = ggName[iCondition],
#       exp = ggName2[iExp]
#     )
#     dat_p = rbind(dat_p,tmp_dat_p)
#   }
# }
# config = list(lim_x = c(min(ind_data$lag),max(ind_data$lag)),
#               lim_y = c(0.4, 0.6),
#               sigBarLoc = 0.57,
#               alpha = 0.4,
#               stride = 0.1,
#               label_x = "",
#               label_y = "AUC",
#               title = "Tertile",
#               errorWid = 0.6
# )
# dat_p['flag'] = rep('gray',dim(dat_p)[1])
# ind = dat_p['pVal'] < 0.1 & dat_p['pVal'] > 0.05 & dat_p$condition == 'Baseline'
# dat_p['data_y'][ind] = 0.58
# dat_p['flag'][ind] = 'gray'
# 
# ind = dat_p['pVal'] < 0.1 & dat_p['pVal'] > 0.05 & dat_p$condition == 'Transient'
# dat_p['data_y'][ind] = 0.44
# dat_p['flag'][ind] = 'gray'
# 
# ind = dat_p['pVal'] < 0.05 & dat_p$condition == 'Baseline'
# dat_p['data_y'][ind] = 0.58
# dat_p['flag'][ind] = 'black'
# 
# ind = dat_p['pVal'] < 0.05 & dat_p$condition == 'Transient'
# dat_p['data_y'][ind] = 0.44
# dat_p['flag'][ind] = 'black'
# 
# ind_data_anova = ind_data[ind_data$exp == 'e1',]
# ind_data_anova$exp = NULL
# ind_data_anova = ind_data_anova[,c(1,3,4,2)]
# anovakun(ind_data_anova,"sAB",long=T, peta=T)
# 
# p = dispLineGraph(ind_data_anova,config,c("lag","condition"))+
#   # scale_color_viridis_c(option = "B")+
#   geom_point(data=dat_p, aes(x=data_x, y = data_y),color=dat_p$flag, size = 2,shape=15)+
#   facet_grid(condition ~ .)
# 
# config$ylim = round(seq(0.4,0.6,0.05),2)
# config$ylim_stride = 0.02
# config$xlim = round(seq(-20,20,5),2)
# config$xlim_stride = 1
# 
# p = setEmptyStyle(p,config)
# 
# eval(parse(text=paste("p", countFigNum ,"=p", sep="")))
# countFigNum = countFigNum+1
# 
# #### plot #### 
# # layout = rbind(c(1,2,3),c(4,4,5))
# # p = combineGraphs(seq(1,countFigNum-1),'p',layout)
# # width_fig=10
# # height_fig=10
# # ggsave(file = "./figure/fig3.pdf",
# #        plot = p, dpi = 500,
# #        width = width_fig, height = height_fig,
# #        family="Times")
# 
# width_fig=6
# height_fig=5
# CairoFonts(regular = "Times","Times")
# CairoPDF(file="./figure/Figure3A",
#          width=width_fig, height=height_fig)
# print(p1)
# dev.off()
# 
# width_fig=1.5
# height_fig=6
# CairoFonts(regular = "Times","Times")
# CairoPDF(file="./figure/Figure3B",
#          width=width_fig, height=height_fig)
# print(p3)
# dev.off()
# 
# width_fig=3
# height_fig=6
# CairoFonts(regular = "Times","Times")
# CairoPDF(file="./figure/Figure3C",
#          width=width_fig, height=height_fig)
# print(p2)
# dev.off()
# 
# width_fig=6 
# height_fig=8
# CairoFonts(regular = "Times","Times")
# CairoPDF(file="./figure/Figure3D",
#          width=width_fig, height=height_fig)
# print(p4)
# dev.off()
# 
# CairoFonts(regular = "Times","Times")
# CairoPDF(file="./figure/Figure3E",
#          width=width_fig, height=height_fig)
# print(p5)
# dev.off()
```
